
<Window x:Class="CC.ImageOverlay.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:CC.ImageOverlay.Views.Controls"
        xmlns:local="clr-namespace:CC.ImageOverlay.Views"
        xmlns:vm="clr-namespace:CC.ImageOverlay.ViewModels"
        xmlns:converters="clr-namespace:CC.ImageOverlay.Converters"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="750" Width="550"
        MinHeight="500" MinWidth="400"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:MonitorDisplayConverter x:Key="MonitorDisplayConverter"/>
        <converters:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
        <converters:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
        <!-- Menu Styles -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        </Style>
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Background="{DynamicResource BackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="12"
            Margin="10"
            Opacity="0">
        <Border.Effect>
            <DropShadowEffect Color="{StaticResource PrimaryColor}" BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
        </Border.Effect>
        <Border.RenderTransform>
            <TranslateTransform Y="20"/>
        </Border.RenderTransform>
        <Border.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                         To="1" Duration="0:0:0.4"/>
                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                         To="0" Duration="0:0:0.5">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                        <TextBlock Text="ðŸ’§" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="CC-ImageOverlay"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   FontSize="12" FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="ðŸ—•" Click="Minimize_Click" 
                                Width="46" Height="32" 
                                Background="Transparent" BorderThickness="0"
                                Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12"/>
                        <Button Content="ðŸ—–" Click="Maximize_Click" 
                                Width="46" Height="32" 
                                Background="Transparent" BorderThickness="0"
                                Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12"/>
                        <Button Content="âœ•" Click="Close_Click" 
                                Width="46" Height="32" 
                                Background="Transparent" BorderThickness="0"
                                Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Menu Bar -->
            <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}">
                <Menu FontSize="12">
                    <MenuItem Header="{Binding MenuFile}">
                        <MenuItem Header="{Binding MenuExit}" Command="{Binding ExitAppCommand}"/>
                    </MenuItem>
                    <MenuItem Header="{Binding MenuSettings}">
                        <MenuItem Header="{Binding MenuLanguage}">
                            <MenuItem Header="æ—¥æœ¬èªž" Command="{Binding ChangeLanguageCommand}" CommandParameter="ja"/>
                            <MenuItem Header="English" Command="{Binding ChangeLanguageCommand}" CommandParameter="en"/>
                            <MenuItem Header="ä¸­æ–‡" Command="{Binding ChangeLanguageCommand}" CommandParameter="zh"/>
                            <MenuItem Header="í•œêµ­ì–´" Command="{Binding ChangeLanguageCommand}" CommandParameter="ko"/>
                        </MenuItem>
                        <MenuItem Header="{Binding MenuTheme}">
                            <MenuItem Header="{Binding MenuThemeSystem}" Command="{Binding ChangeThemeCommand}" CommandParameter="System"/>
                            <MenuItem Header="{Binding MenuThemeDark}" Command="{Binding ChangeThemeCommand}" CommandParameter="Dark"/>
                            <MenuItem Header="{Binding MenuThemeLight}" Command="{Binding ChangeThemeCommand}" CommandParameter="Light"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="{Binding MenuHotkey}" Click="Menu_Hotkey_Click"/>
                    </MenuItem>
                    <MenuItem Header="{Binding MenuHelp}">
                        <MenuItem Header="{Binding MenuAbout}" Click="Menu_About_Click"/>
                    </MenuItem>
                </Menu>
            </Border>

            <!-- Tab Bar -->
            <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="16,8">
                <StackPanel Orientation="Horizontal">
                    <RadioButton Content="{Binding TabImageMode}" 
                                 IsChecked="{Binding SelectedTabIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}" 
                                 GroupName="Tabs"
                                 Style="{DynamicResource TabRadioButtonStyle}"/>
                    <RadioButton Content="{Binding TabMemoMode}" 
                                 IsChecked="{Binding SelectedTabIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}" 
                                 GroupName="Tabs"
                                 Style="{DynamicResource TabRadioButtonStyle}"/>
                </StackPanel>
            </Border>

            <!-- Content Area -->
            <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" Padding="16">
                <Grid>
                    <!-- Image Mode Panel -->
                    <StackPanel Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0}">
                        <!-- Image Selection Card -->
                        <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,16">
                            <StackPanel DataContext="{Binding ImageMode}">
                                <TextBlock Text="{Binding LabelImageSelection}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                
                                <TextBlock Text="{Binding SelectedImagePathText}" 
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,0,0,8"
                                           TextTrimming="CharacterEllipsis"/>
                                
                                <Button Content="{Binding ButtonSelectImage}" 
                                        Command="{Binding SelectImageCommand}"
                                        Style="{DynamicResource PrimaryButtonStyle}"
                                        HorizontalAlignment="Left"
                                        Padding="20,10"/>
                            </StackPanel>
                        </Border>

                        <!-- Position Card -->
                        <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="{Binding ImageMode.LabelImagePosition}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                
                                <controls:PreviewWidget Height="180"
                                                        MonitorWidth="{Binding SelectedMonitor.Width, FallbackValue=1920}"
                                                        MonitorHeight="{Binding SelectedMonitor.Height, FallbackValue=1080}"
                                                        OverlayX="{Binding ImageMode.PositionX, Mode=TwoWay}"
                                                        OverlayY="{Binding ImageMode.PositionY, Mode=TwoWay}"
                                                        OverlayWidth="{Binding ImageMode.ImageWidth, Mode=TwoWay}"
                                                        OverlayHeight="{Binding ImageMode.ImageHeight, Mode=TwoWay}"
                                                        AspectRatio="{Binding ImageMode.AspectRatio}"
                                                        Margin="0,0,0,12"/>

                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="{Binding ImageMode.LabelMonitor}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <ComboBox ItemsSource="{Binding Monitors}"
                                              SelectedItem="{Binding SelectedMonitor}"
                                              Margin="0,0,0,10">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource MonitorDisplayConverter}}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Settings Card -->
                        <Border Style="{DynamicResource CardStyle}">
                            <StackPanel DataContext="{Binding ImageMode}">
                                <TextBlock Text="{Binding LabelOverlaySettings}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                
                                <!-- Opacity -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelOpacity}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <Slider Minimum="0" Maximum="100" Value="{Binding Opacity}"
                                            Width="200" VerticalAlignment="Center"
                                            Style="{DynamicResource CyanSliderStyle}"/>
                                    <TextBlock Text="{Binding Opacity, StringFormat=\{0:0\}%}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0" Width="50"/>
                                </StackPanel>

                                <!-- Scale -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelScale}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <Slider Minimum="10" Maximum="{Binding MaxScale}" Value="{Binding Scale}"
                                            Width="200" VerticalAlignment="Center"
                                            Style="{DynamicResource CyanSliderStyle}"/>
                                    <TextBlock Text="{Binding Scale, StringFormat=\{0:0\}%}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0" Width="50"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Memo Mode Panel -->
                    <StackPanel Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1}">
                        <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="{Binding MemoMode.LabelMemoText}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                <TextBox Text="{Binding MemoMode.MemoText, UpdateSourceTrigger=PropertyChanged}"
                                         Height="100" 
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"
                                         Background="{DynamicResource SurfaceBrush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}"
                                         BorderBrush="{DynamicResource BorderBrush}"
                                         Padding="12"/>
                            </StackPanel>
                        </Border>

                        <!-- Memo Position Card -->
                        <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="{Binding MemoMode.LabelMemoPosition}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                
                                <controls:PreviewWidget Height="150"
                                                        MonitorWidth="{Binding SelectedMonitor.Width, FallbackValue=1920}"
                                                        MonitorHeight="{Binding SelectedMonitor.Height, FallbackValue=1080}"
                                                        OverlayX="{Binding MemoMode.PositionX, Mode=TwoWay}"
                                                        OverlayY="{Binding MemoMode.PositionY, Mode=TwoWay}"
                                                        OverlayWidth="{Binding MemoMode.Width, Mode=TwoWay}"
                                                        OverlayHeight="{Binding MemoMode.Height, Mode=TwoWay}"
                                                        Margin="0,0,0,12"/>

                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="{Binding MemoMode.LabelMemoMonitor}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <ComboBox ItemsSource="{Binding Monitors}"
                                              SelectedItem="{Binding SelectedMonitor}"
                                              Margin="5">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource MonitorDisplayConverter}}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Memo Style Card -->
                        <Border Style="{DynamicResource CardStyle}">
                            <StackPanel DataContext="{Binding MemoMode}">
                                <TextBlock Text="{Binding LabelMemoStyle}" Style="{DynamicResource TitleTextStyle}" Margin="0,0,0,12"/>
                                
                                <!-- Font -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelMemoFont}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <ComboBox ItemsSource="{Binding Source={x:Static vm:MemoModeViewModel.AvailableFonts}}"
                                              SelectedItem="{Binding FontFamily}"
                                              Width="200"/>
                                </StackPanel>

                                <!-- Font Size -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelMemoFontSize}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <Slider Minimum="8" Maximum="72" Value="{Binding FontSize}"
                                            Width="200" VerticalAlignment="Center"
                                            Style="{DynamicResource CyanSliderStyle}"/>
                                    <TextBlock Text="{Binding FontSize, StringFormat=\{0:0\}pt}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0" Width="50"/>
                                </StackPanel>

                                <!-- Window Width -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelMemoWidth}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <Slider Minimum="100" Maximum="800" Value="{Binding Width}"
                                            Width="200" VerticalAlignment="Center"
                                            Style="{DynamicResource CyanSliderStyle}"/>
                                    <TextBlock Text="{Binding Width, StringFormat=\{0:0\}px}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0" Width="60"/>
                                </StackPanel>

                                <!-- Window Height -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelMemoHeight}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/>
                                    <Slider Minimum="50" Maximum="600" Value="{Binding Height}"
                                            Width="200" VerticalAlignment="Center"
                                            Style="{DynamicResource CyanSliderStyle}"/>
                                    <TextBlock Text="{Binding Height, StringFormat=\{0:0\}px}"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0" Width="60"/>
                                </StackPanel>

                                <!-- Text Color -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="{Binding LabelMemoColor}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/> 
                                    <Border Width="100" Height="28" 
                                            Background="{Binding TextColor, Converter={StaticResource ColorToBrushConverter}}" 
                                            BorderBrush="{DynamicResource BorderBrush}" 
                                            BorderThickness="1" CornerRadius="4"
                                            MouseLeftButtonDown="TextColorPreview_Click" Cursor="Hand"/>
                                    <TextBlock Text="{Binding TextColor}"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>

                                <!-- Background Color -->
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding LabelMemoBgColor}" Style="{DynamicResource LabelTextStyle}"
                                               VerticalAlignment="Center" Width="80"/> 
                                    <Border Width="100" Height="28" 
                                            Background="{Binding BackgroundColor, Converter={StaticResource ColorToBrushConverter}}" 
                                            BorderBrush="{DynamicResource BorderBrush}" 
                                            BorderThickness="1" CornerRadius="4"
                                            MouseLeftButtonDown="BgColorPreview_Click" Cursor="Hand"/>
                                    <TextBlock Text="{Binding BackgroundColor}"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </ScrollViewer>

            <!-- Action Bar -->
            <Border Grid.Row="4"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="0,0,12,12"
                    Padding="16">
                <Button Content="{Binding ActionButtonText}"
                        Command="{Binding ToggleActionCommand}"
                        Style="{DynamicResource PrimaryButtonStyle}"
                        HorizontalAlignment="Stretch"
                        FontSize="14"/>
            </Border>
        </Grid>
    </Border>
</Window>
